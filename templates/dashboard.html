<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Voca - 학습 대시보드</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Noto Sans KR', -apple-system, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      color: #eee;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      padding: 30px 0;
      border-bottom: 2px solid #4a4a6a;
      margin-bottom: 30px;
    }

    header h1 {
      font-size: 2.5em;
      background: linear-gradient(90deg, #00d4ff, #7b2cbf);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 10px;
    }

    header p { color: #888; }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: rgba(255,255,255,0.05);
      border-radius: 15px;
      padding: 25px;
      text-align: center;
      border: 1px solid rgba(255,255,255,0.1);
      transition: transform 0.2s;
    }

    .stat-card:hover {
      transform: translateY(-5px);
      border-color: #00d4ff;
    }

    .stat-card .number {
      font-size: 3em;
      font-weight: bold;
      color: #00d4ff;
    }

    .stat-card .label {
      color: #888;
      margin-top: 10px;
    }

    .progress-section {
      background: rgba(255,255,255,0.05);
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 30px;
    }

    .progress-section h2 {
      margin-bottom: 20px;
      color: #fff;
    }

    .progress-bar-container {
      margin-bottom: 15px;
    }

    .progress-bar-label {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 0.9em;
    }

    .progress-bar {
      height: 25px;
      background: rgba(255,255,255,0.1);
      border-radius: 12px;
      overflow: hidden;
    }

    .progress-bar-fill {
      height: 100%;
      border-radius: 12px;
      transition: width 0.5s ease;
    }

    .fill-learned { background: linear-gradient(90deg, #00d4ff, #00ff88); }
    .fill-progress { background: linear-gradient(90deg, #ffd700, #ff8c00); }
    .fill-notstarted { background: linear-gradient(90deg, #666, #888); }

    .word-list {
      background: rgba(255,255,255,0.05);
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 30px;
    }

    .word-list h2 { margin-bottom: 20px; }

    .word-card {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      background: rgba(255,255,255,0.03);
      border-radius: 10px;
      margin-bottom: 10px;
      border-left: 4px solid;
    }

    .word-card.weak { border-color: #ff4757; }
    .word-card.learning { border-color: #ffd700; }
    .word-card.learned { border-color: #00ff88; }

    .word-info h3 { font-size: 1.2em; margin-bottom: 5px; }
    .word-info p { color: #888; font-size: 0.9em; }

    .word-stats {
      text-align: right;
    }

    .accuracy {
      font-size: 1.5em;
      font-weight: bold;
    }

    .accuracy.high { color: #00ff88; }
    .accuracy.medium { color: #ffd700; }
    .accuracy.low { color: #ff4757; }

    .actions {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 30px;
    }

    .btn {
      padding: 15px 40px;
      border: none;
      border-radius: 10px;
      font-size: 1.1em;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
      color: #fff;
    }

    .btn-primary {
      background: linear-gradient(90deg, #00d4ff, #7b2cbf);
    }

    .btn-secondary {
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
    }

    .btn:hover {
      transform: scale(1.05);
      box-shadow: 0 5px 20px rgba(0,212,255,0.3);
    }

    .grade-badge {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 5px;
      font-size: 0.8em;
      font-weight: bold;
    }

    .grade-S { background: #7b2cbf; }
    .grade-A { background: #00d4ff; }
    .grade-B { background: #00ff88; color: #000; }
    .grade-C { background: #ffd700; color: #000; }
    .grade-F { background: #ff4757; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>MY VOCA</h1>
      <p>English Vocabulary Learning Dashboard</p>
    </header>

    <div class="stats-grid">
      <div class="stat-card">
        <div class="number" id="totalWords">0</div>
        <div class="label">총 단어</div>
      </div>
      <div class="stat-card">
        <div class="number" id="learnedWords">0</div>
        <div class="label">학습 완료</div>
      </div>
      <div class="stat-card">
        <div class="number" id="accuracy">0%</div>
        <div class="label">정답률</div>
      </div>
      <div class="stat-card">
        <div class="number" id="todayReviewed">0</div>
        <div class="label">오늘 복습</div>
      </div>
    </div>

    <div class="progress-section">
      <h2>학습 진행 현황</h2>
      <div class="progress-bar-container">
        <div class="progress-bar-label">
          <span>학습 완료</span>
          <span id="learnedPercent">0%</span>
        </div>
        <div class="progress-bar">
          <div class="progress-bar-fill fill-learned" id="learnedBar" style="width: 0%"></div>
        </div>
      </div>
      <div class="progress-bar-container">
        <div class="progress-bar-label">
          <span>학습 중</span>
          <span id="progressPercent">0%</span>
        </div>
        <div class="progress-bar">
          <div class="progress-bar-fill fill-progress" id="progressBar" style="width: 0%"></div>
        </div>
      </div>
      <div class="progress-bar-container">
        <div class="progress-bar-label">
          <span>미시작</span>
          <span id="notStartedPercent">0%</span>
        </div>
        <div class="progress-bar">
          <div class="progress-bar-fill fill-notstarted" id="notStartedBar" style="width: 0%"></div>
        </div>
      </div>
    </div>

    <div class="word-list">
      <h2>복습 필요 단어 (취약 단어)</h2>
      <div id="weakWords">
        <!-- 동적으로 생성 -->
      </div>
    </div>

    <div class="actions">
      <a href="quiz.html" class="btn btn-primary">퀴즈 시작</a>
      <a href="cards.html" class="btn btn-secondary">플래시카드</a>
    </div>
  </div>

  <script>
    // DATA 변수는 플러그인에서 주입됨
    const DATA = window.VOCA_DATA || {
      metadata: { name: "샘플 데이터", totalWords: 0 },
      words: []
    };

    function calculateStats() {
      const words = DATA.words || [];
      const total = words.length;

      let learned = 0, inProgress = 0, notStarted = 0;
      let totalCorrect = 0, totalAttempts = 0;
      let todayReviewed = 0;
      const today = new Date().toISOString().split('T')[0];

      const weakWords = [];

      words.forEach(word => {
        const stats = word.stats || { correctCount: 0, wrongCount: 0 };
        const attempts = stats.correctCount + stats.wrongCount;
        const accuracy = attempts > 0 ? stats.correctCount / attempts : 0;

        totalCorrect += stats.correctCount;
        totalAttempts += attempts;

        if (stats.lastReviewed === today) todayReviewed++;

        if (stats.correctCount >= 3 && accuracy >= 0.7) {
          learned++;
        } else if (attempts > 0) {
          inProgress++;
          if (accuracy < 0.5) {
            weakWords.push({ ...word, accuracy: Math.round(accuracy * 100) });
          }
        } else {
          notStarted++;
        }
      });

      return {
        total,
        learned,
        inProgress,
        notStarted,
        accuracy: totalAttempts > 0 ? Math.round((totalCorrect / totalAttempts) * 100) : 0,
        todayReviewed,
        weakWords: weakWords.sort((a, b) => a.accuracy - b.accuracy).slice(0, 5)
      };
    }

    function render() {
      const stats = calculateStats();

      document.getElementById('totalWords').textContent = stats.total;
      document.getElementById('learnedWords').textContent = stats.learned;
      document.getElementById('accuracy').textContent = stats.accuracy + '%';
      document.getElementById('todayReviewed').textContent = stats.todayReviewed;

      const learnedPct = stats.total > 0 ? Math.round((stats.learned / stats.total) * 100) : 0;
      const progressPct = stats.total > 0 ? Math.round((stats.inProgress / stats.total) * 100) : 0;
      const notStartedPct = stats.total > 0 ? Math.round((stats.notStarted / stats.total) * 100) : 0;

      document.getElementById('learnedPercent').textContent = learnedPct + '%';
      document.getElementById('progressPercent').textContent = progressPct + '%';
      document.getElementById('notStartedPercent').textContent = notStartedPct + '%';

      document.getElementById('learnedBar').style.width = learnedPct + '%';
      document.getElementById('progressBar').style.width = progressPct + '%';
      document.getElementById('notStartedBar').style.width = notStartedPct + '%';

      // 취약 단어 렌더링
      const weakWordsContainer = document.getElementById('weakWords');
      if (stats.weakWords.length === 0) {
        weakWordsContainer.innerHTML = '<p style="color: #888; text-align: center; padding: 20px;">취약 단어가 없습니다!</p>';
      } else {
        weakWordsContainer.innerHTML = stats.weakWords.map(word => {
          const accClass = word.accuracy < 30 ? 'low' : word.accuracy < 50 ? 'medium' : 'high';
          const grade = word.accuracy < 30 ? 'F' : word.accuracy < 50 ? 'C' : 'B';
          return `
            <div class="word-card weak">
              <div class="word-info">
                <h3>${word.word} <span class="grade-badge grade-${grade}">${grade}</span></h3>
                <p>${word.meaning}</p>
              </div>
              <div class="word-stats">
                <div class="accuracy ${accClass}">${word.accuracy}%</div>
                <div style="color: #888; font-size: 0.8em;">정답률</div>
              </div>
            </div>
          `;
        }).join('');
      }
    }

    render();
  </script>
</body>
</html>
